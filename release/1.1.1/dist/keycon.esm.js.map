{"version":3,"file":"keycon.esm.js","sources":["../src/KeyController.ts"],"sourcesContent":["import EventEmitter, { EmitterParam, TargetParam } from \"@scena/event-emitter\";\nimport { names } from \"keycode\";\nimport { isString, isArray, addEvent, removeEvent } from \"@daybrush/utils\";\n\nconst codeData = {\n    \"+\": \"plus\",\n    \"left command\": \"meta\",\n    \"right command\": \"meta\",\n};\nconst keysSort = {\n    shift: 1,\n    ctrl: 2,\n    alt: 3,\n    meta: 4,\n};\n/**\n * @memberof KeyController\n */\nexport function getKey(keyCode: number): string {\n    let key = names[keyCode] || \"\";\n\n    for (const name in codeData) {\n        key = key.replace(name, codeData[name]);\n    }\n    return key.replace(/\\s/g, \"\");\n}\n\n/**\n * @memberof KeyController\n */\nexport function getCombi(e: KeyboardEvent, key: string = getKey(e.keyCode)): string[] {\n    const keys = getModifierCombi(e);\n    keys.indexOf(key) === -1 && keys.push(key);\n\n    return keys.filter(Boolean);\n}\n\n/**\n * @memberof KeyController\n */\nexport function getModifierCombi(e: KeyboardEvent): string[] {\n    const keys = [e.shiftKey && \"shift\", e.ctrlKey && \"ctrl\", e.altKey && \"alt\", e.metaKey && \"meta\"];\n\n    return keys.filter(Boolean);\n}\n\nfunction getArrangeCombi(keys: string[]) {\n    const arrangeKeys = keys.slice();\n    arrangeKeys.sort((prev, next) => {\n        const prevScore = keysSort[prev] || 5;\n        const nextScore = keysSort[next] || 5;\n\n        return prevScore - nextScore;\n    });\n\n    return arrangeKeys;\n}\n/**\n * @typedef\n * @memberof KeyController\n */\nexport interface KeyControllerEvent extends EmitterParam {\n    inputEvent: KeyboardEvent;\n    isToggle: boolean;\n    key: string;\n    keyCode: number;\n    ctrlKey: boolean;\n    altKey: boolean;\n    shiftKey: boolean;\n    metaKey: boolean;\n}\nlet globalKeyController!: KeyController;\n\n/**\n */\nclass KeyController extends EventEmitter<{\n    blur: {},\n    [key: string]: object,\n}> {\n    /**\n     */\n    public static get global() {\n        return globalKeyController || (globalKeyController = new KeyController());\n    }\n    public static setGlobal() {\n        return this.global;\n    }\n    /**\n     */\n    public ctrlKey = false;\n    /**\n     */\n    public altKey = false;\n    /**\n     *\n     */\n    public shiftKey = false;\n    /**\n     *\n     */\n    public metaKey = false;\n    /**\n     *\n     */\n    constructor(private container: Window | Document | HTMLElement = window) {\n        super();\n\n        addEvent(container, \"blur\", this.blur);\n        addEvent(container, \"keydown\", this.keydownEvent);\n        addEvent(container, \"keyup\", this.keyupEvent);\n    }\n    public clear = (): this => {\n        this.ctrlKey = false;\n        this.altKey = false;\n        this.shiftKey = false;\n        this.metaKey = false;\n        return this;\n    }\n    /**\n     *\n     */\n    public destroy() {\n        const container = this.container as any;\n\n        this.clear();\n        this.off();\n        removeEvent(container, \"blur\", this.blur);\n        removeEvent(container, \"keydown\", this.keydownEvent);\n        removeEvent(container, \"keyup\", this.keyupEvent);\n    }\n    public keydown(comb: string | string[], callback: (e: KeyControllerEvent) => void): this;\n    public keydown(callback: (e: KeyControllerEvent) => void): this;\n    /**\n     *\n     */\n    public keydown(\n        comb: string | string[] | ((e: KeyControllerEvent) => void),\n        callback?: (e: KeyControllerEvent) => void,\n    ): this {\n        return this.addEvent(\"keydown\", comb, callback);\n    }\n    public offKeydown(comb: string | string[], callback?: (e: KeyControllerEvent) => void): this;\n    public offKeydown(callback: (e: KeyControllerEvent) => void): this;\n    /**\n     *\n     */\n    public offKeydown(\n        comb: string | string[] | ((e: KeyControllerEvent) => void),\n        callback?: (e: KeyControllerEvent) => void,\n    ): this {\n        return this.removeEvent(\"keydown\", comb, callback);\n    }\n    public offKeyup(comb: string | string[], callback?: (e: KeyControllerEvent) => void): this;\n    public offKeyup(callback: (e: KeyControllerEvent) => void): this;\n    /**\n     *\n     */\n    public offKeyup(\n        comb: string | string[] | ((e: KeyControllerEvent) => void),\n        callback?: (e: KeyControllerEvent) => void,\n    ): this {\n        return this.removeEvent(\"keyup\", comb, callback);\n    }\n    public keyup(comb: string | string[], callback: (e: KeyControllerEvent) => void): this;\n    public keyup(callback: (e: KeyControllerEvent) => void): this;\n    /**\n     *\n     */\n    public keyup(\n        comb: string | string[] | ((e: KeyControllerEvent) => void),\n        callback?: (e: KeyControllerEvent) => void,\n    ): this {\n        return this.addEvent(\"keyup\", comb, callback);\n    }\n    private addEvent(\n        type: \"keydown\" | \"keyup\",\n        comb: string | string[] | ((e: KeyControllerEvent) => void),\n        callback?: (e: KeyControllerEvent) => void,\n    ) {\n        if (isArray(comb)) {\n            this.on(`${type}.${getArrangeCombi(comb).join(\".\")}`, callback);\n        } else if (isString(comb)) {\n            this.on(`${type}.${comb}`, callback);\n        } else {\n            this.on(type, comb);\n        }\n        return this;\n    }\n    private removeEvent(\n        type: \"keydown\" | \"keyup\",\n        comb: string | string[] | ((e: KeyControllerEvent) => void) | undefined,\n        callback?: (e: KeyControllerEvent) => void,\n    ) {\n        if (isArray(comb)) {\n            this.off(`${type}.${getArrangeCombi(comb).join(\".\")}`, callback);\n        } else if (isString(comb)) {\n            this.off(`${type}.${comb}`, callback);\n        } else {\n            this.off(type, comb);\n        }\n        return this;\n    }\n    private triggerEvent(type: \"keydown\" | \"keyup\", e: KeyboardEvent) {\n        this.ctrlKey = e.ctrlKey;\n        this.shiftKey = e.shiftKey;\n        this.altKey = e.altKey;\n        this.metaKey = e.metaKey;\n\n        const key = getKey(e.keyCode);\n        const isToggle = key === \"ctrl\"\n            || key === \"shift\"\n            || key === \"meta\"\n            || key === \"alt\";\n        const param: TargetParam<KeyControllerEvent> = {\n            key,\n            isToggle,\n            inputEvent: e,\n            keyCode: e.keyCode,\n            ctrlKey: e.ctrlKey,\n            altKey: e.altKey,\n            shiftKey: e.shiftKey,\n            metaKey: e.metaKey,\n        };\n        this.trigger(type, param);\n        this.trigger(`${type}.${key}`, param);\n\n        const combi = getCombi(e, key);\n\n        combi.length > 1 && this.trigger(`${type}.${combi.join(\".\")}`, param);\n    }\n    private keydownEvent = (e: KeyboardEvent) => {\n        this.triggerEvent(\"keydown\", e);\n    }\n    private keyupEvent = (e: KeyboardEvent) => {\n        this.triggerEvent(\"keyup\", e);\n    }\n    private blur = () => {\n        this.clear();\n        this.trigger(\"blur\");\n    }\n}\n\nexport default KeyController;\n"],"names":["codeData","keysSort","shift","ctrl","alt","meta","getKey","keyCode","key","names","name","replace","getCombi","e","keys","getModifierCombi","indexOf","push","filter","Boolean","shiftKey","ctrlKey","altKey","metaKey","getArrangeCombi","arrangeKeys","slice","sort","prev","next","prevScore","nextScore","globalKeyController","__extends","container","_super","_this","triggerEvent","clear","trigger","addEvent","blur","keydownEvent","keyupEvent","Object","KeyController","global","off","removeEvent","comb","callback","type","isArray","on","join","isString","isToggle","param","inputEvent","combi","length","EventEmitter"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAIA,IAAMA,QAAQ,GAAG;AACb,OAAK,MADQ;AAEb,kBAAgB,MAFH;AAGb,mBAAiB;AAHJ,CAAjB;AAKA,IAAMC,QAAQ,GAAG;AACbC,EAAAA,KAAK,EAAE,CADM;AAEbC,EAAAA,IAAI,EAAE,CAFO;AAGbC,EAAAA,GAAG,EAAE,CAHQ;AAIbC,EAAAA,IAAI,EAAE;AAJO,CAAjB;AAMA;;;;AAGA,SAAgBC,OAAOC;AACnB,MAAIC,GAAG,GAAGC,SAAK,CAACF,OAAD,CAAL,IAAkB,EAA5B;;AAEA,OAAK,IAAMG,IAAX,IAAmBV,QAAnB,EAA6B;AACzBQ,IAAAA,GAAG,GAAGA,GAAG,CAACG,OAAJ,CAAYD,IAAZ,EAAkBV,QAAQ,CAACU,IAAD,CAA1B,CAAN;AACH;;AACD,SAAOF,GAAG,CAACG,OAAJ,CAAY,KAAZ,EAAmB,EAAnB,CAAP;AACH;AAED;;;;AAGA,SAAgBC,SAASC,GAAkBL;AAAA,oBAAA,EAAA;AAAAA,IAAAA,MAAcF,MAAM,CAACO,CAAC,CAACN,OAAH,CAApB;;;AACvC,MAAMO,IAAI,GAAGC,gBAAgB,CAACF,CAAD,CAA7B;AACAC,EAAAA,IAAI,CAACE,OAAL,CAAaR,GAAb,MAAsB,CAAC,CAAvB,IAA4BM,IAAI,CAACG,IAAL,CAAUT,GAAV,CAA5B;AAEA,SAAOM,IAAI,CAACI,MAAL,CAAYC,OAAZ,CAAP;AACH;AAED;;;;AAGA,SAAgBJ,iBAAiBF;AAC7B,MAAMC,IAAI,GAAG,CAACD,CAAC,CAACO,QAAF,IAAc,OAAf,EAAwBP,CAAC,CAACQ,OAAF,IAAa,MAArC,EAA6CR,CAAC,CAACS,MAAF,IAAY,KAAzD,EAAgET,CAAC,CAACU,OAAF,IAAa,MAA7E,CAAb;AAEA,SAAOT,IAAI,CAACI,MAAL,CAAYC,OAAZ,CAAP;AACH;;AAED,SAASK,eAAT,CAAyBV,IAAzB;AACI,MAAMW,WAAW,GAAGX,IAAI,CAACY,KAAL,EAApB;AACAD,EAAAA,WAAW,CAACE,IAAZ,CAAiB,UAACC,IAAD,EAAOC,IAAP;AACb,QAAMC,SAAS,GAAG7B,QAAQ,CAAC2B,IAAD,CAAR,IAAkB,CAApC;AACA,QAAMG,SAAS,GAAG9B,QAAQ,CAAC4B,IAAD,CAAR,IAAkB,CAApC;AAEA,WAAOC,SAAS,GAAGC,SAAnB;AACH,GALD;AAOA,SAAON,WAAP;AACH;;AAeD,IAAIO,mBAAJ;AAEA;;;AAEA;;;AAA4BC,EAAAA,gCAAA;AA0BxB;;;;;AAGA,wBAAA,CAAoBC,SAApB;AAAoB,4BAAA,EAAA;AAAAA,MAAAA,kBAAA;;;AAApB,gBACIC,WAAA,KAAA,SADJ;;AAAoBC,IAAAA,eAAA,GAAAF,SAAA;AAjBpB;;;AAEOE,IAAAA,aAAA,GAAU,KAAV;AACP;;;AAEOA,IAAAA,YAAA,GAAS,KAAT;AACP;;;;AAGOA,IAAAA,cAAA,GAAW,KAAX;AACP;;;;AAGOA,IAAAA,aAAA,GAAU,KAAV;;AAWAA,IAAAA,WAAA,GAAQ;AACXA,MAAAA,KAAI,CAACf,OAAL,GAAe,KAAf;AACAe,MAAAA,KAAI,CAACd,MAAL,GAAc,KAAd;AACAc,MAAAA,KAAI,CAAChB,QAAL,GAAgB,KAAhB;AACAgB,MAAAA,KAAI,CAACb,OAAL,GAAe,KAAf;AACA,aAAOa,KAAP;AACH,KANM;;AAuHCA,IAAAA,kBAAA,GAAe,UAACvB,CAAD;AACnBuB,MAAAA,KAAI,CAACC,YAAL,CAAkB,SAAlB,EAA6BxB,CAA7B;AACH,KAFO;;AAGAuB,IAAAA,gBAAA,GAAa,UAACvB,CAAD;AACjBuB,MAAAA,KAAI,CAACC,YAAL,CAAkB,OAAlB,EAA2BxB,CAA3B;AACH,KAFO;;AAGAuB,IAAAA,UAAA,GAAO;AACXA,MAAAA,KAAI,CAACE,KAAL;;AACAF,MAAAA,KAAI,CAACG,OAAL,CAAa,MAAb;AACH,KAHO;;AAjIJC,IAAAA,QAAQ,CAACN,SAAD,EAAY,MAAZ,EAAoBE,KAAI,CAACK,IAAzB,CAAR;AACAD,IAAAA,QAAQ,CAACN,SAAD,EAAY,SAAZ,EAAuBE,KAAI,CAACM,YAA5B,CAAR;AACAF,IAAAA,QAAQ,CAACN,SAAD,EAAY,OAAZ,EAAqBE,KAAI,CAACO,UAA1B,CAAR;;AACH;;;AA7BDC,EAAAA,qBAAA,CAAkBC,aAAlB,UAAA;AAFA;;SAEA;AACI,aAAOb,mBAAmB,KAAKA,mBAAmB,GAAG,IAAIa,aAAJ,EAA3B,CAA1B;AACH;;;GAFD;;AAGcA,EAAAA,uBAAA,GAAd;AACI,WAAO,KAAKC,MAAZ;AACH,GAFa;AAkCd;;;;;AAGO,iBAAA,GAAP;AACI,QAAMZ,SAAS,GAAG,KAAKA,SAAvB;AAEA,SAAKI,KAAL;AACA,SAAKS,GAAL;AACAC,IAAAA,WAAW,CAACd,SAAD,EAAY,MAAZ,EAAoB,KAAKO,IAAzB,CAAX;AACAO,IAAAA,WAAW,CAACd,SAAD,EAAY,SAAZ,EAAuB,KAAKQ,YAA5B,CAAX;AACAM,IAAAA,WAAW,CAACd,SAAD,EAAY,OAAZ,EAAqB,KAAKS,UAA1B,CAAX;AACH,GARM;AAWP;;;;;AAGO,iBAAA,GAAP,UACIM,IADJ,EAEIC,QAFJ;AAII,WAAO,KAAKV,QAAL,CAAc,SAAd,EAAyBS,IAAzB,EAA+BC,QAA/B,CAAP;AACH,GALM;AAQP;;;;;AAGO,oBAAA,GAAP,UACID,IADJ,EAEIC,QAFJ;AAII,WAAO,KAAKF,WAAL,CAAiB,SAAjB,EAA4BC,IAA5B,EAAkCC,QAAlC,CAAP;AACH,GALM;AAQP;;;;;AAGO,kBAAA,GAAP,UACID,IADJ,EAEIC,QAFJ;AAII,WAAO,KAAKF,WAAL,CAAiB,OAAjB,EAA0BC,IAA1B,EAAgCC,QAAhC,CAAP;AACH,GALM;AAQP;;;;;AAGO,eAAA,GAAP,UACID,IADJ,EAEIC,QAFJ;AAII,WAAO,KAAKV,QAAL,CAAc,OAAd,EAAuBS,IAAvB,EAA6BC,QAA7B,CAAP;AACH,GALM;;AAMC,kBAAA,GAAR,UACIC,IADJ,EAEIF,IAFJ,EAGIC,QAHJ;AAKI,QAAIE,OAAO,CAACH,IAAD,CAAX,EAAmB;AACf,WAAKI,EAAL,CAAWF,IAAI,MAAJ,GAAQ3B,eAAe,CAACyB,IAAD,CAAf,CAAsBK,IAAtB,CAA2B,GAA3B,CAAnB,EAAsDJ,QAAtD;AACH,KAFD,MAEO,IAAIK,QAAQ,CAACN,IAAD,CAAZ,EAAoB;AACvB,WAAKI,EAAL,CAAWF,IAAI,MAAJ,GAAQF,IAAnB,EAA2BC,QAA3B;AACH,KAFM,MAEA;AACH,WAAKG,EAAL,CAAQF,IAAR,EAAcF,IAAd;AACH;;AACD,WAAO,IAAP;AACH,GAbO;;AAcA,qBAAA,GAAR,UACIE,IADJ,EAEIF,IAFJ,EAGIC,QAHJ;AAKI,QAAIE,OAAO,CAACH,IAAD,CAAX,EAAmB;AACf,WAAKF,GAAL,CAAYI,IAAI,MAAJ,GAAQ3B,eAAe,CAACyB,IAAD,CAAf,CAAsBK,IAAtB,CAA2B,GAA3B,CAApB,EAAuDJ,QAAvD;AACH,KAFD,MAEO,IAAIK,QAAQ,CAACN,IAAD,CAAZ,EAAoB;AACvB,WAAKF,GAAL,CAAYI,IAAI,MAAJ,GAAQF,IAApB,EAA4BC,QAA5B;AACH,KAFM,MAEA;AACH,WAAKH,GAAL,CAASI,IAAT,EAAeF,IAAf;AACH;;AACD,WAAO,IAAP;AACH,GAbO;;AAcA,sBAAA,GAAR,UAAqBE,IAArB,EAAgDtC,CAAhD;AACI,SAAKQ,OAAL,GAAeR,CAAC,CAACQ,OAAjB;AACA,SAAKD,QAAL,GAAgBP,CAAC,CAACO,QAAlB;AACA,SAAKE,MAAL,GAAcT,CAAC,CAACS,MAAhB;AACA,SAAKC,OAAL,GAAeV,CAAC,CAACU,OAAjB;AAEA,QAAMf,GAAG,GAAGF,MAAM,CAACO,CAAC,CAACN,OAAH,CAAlB;AACA,QAAMiD,QAAQ,GAAGhD,GAAG,KAAK,MAAR,IACVA,GAAG,KAAK,OADE,IAEVA,GAAG,KAAK,MAFE,IAGVA,GAAG,KAAK,KAHf;AAIA,QAAMiD,KAAK,GAAoC;AAC3CjD,MAAAA,GAAG,KADwC;AAE3CgD,MAAAA,QAAQ,UAFmC;AAG3CE,MAAAA,UAAU,EAAE7C,CAH+B;AAI3CN,MAAAA,OAAO,EAAEM,CAAC,CAACN,OAJgC;AAK3Cc,MAAAA,OAAO,EAAER,CAAC,CAACQ,OALgC;AAM3CC,MAAAA,MAAM,EAAET,CAAC,CAACS,MANiC;AAO3CF,MAAAA,QAAQ,EAAEP,CAAC,CAACO,QAP+B;AAQ3CG,MAAAA,OAAO,EAAEV,CAAC,CAACU;AARgC,KAA/C;AAUA,SAAKgB,OAAL,CAAaY,IAAb,EAAmBM,KAAnB;AACA,SAAKlB,OAAL,CAAgBY,IAAI,MAAJ,GAAQ3C,GAAxB,EAA+BiD,KAA/B;AAEA,QAAME,KAAK,GAAG/C,QAAQ,CAACC,CAAD,EAAIL,GAAJ,CAAtB;AAEAmD,IAAAA,KAAK,CAACC,MAAN,GAAe,CAAf,IAAoB,KAAKrB,OAAL,CAAgBY,IAAI,MAAJ,GAAQQ,KAAK,CAACL,IAAN,CAAW,GAAX,CAAxB,EAA2CG,KAA3C,CAApB;AACH,GA3BO;;AAsCZ,sBAAA;AArKA,EAA4BI,aAA5B;;;;;"}