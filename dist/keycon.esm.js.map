{"version":3,"file":"keycon.esm.js","sources":["../src/KeyController.ts"],"sourcesContent":["import Component from \"@egjs/component\";\nimport { names } from \"keycode\";\nimport { isString, isArray, addEvent } from \"@daybrush/utils\";\n\nconst codeData = {\n    \"+\": \"plus\",\n    \"left command\": \"meta\",\n    \"right command\": \"meta\",\n};\nconst keysSort = {\n    shift: 1,\n    ctrl: 2,\n    alt: 3,\n    meta: 4,\n};\n/**\n * @memberof KeyController\n */\nexport function getKey(keyCode: number): string {\n    let key = names[keyCode] || \"\";\n\n    for (const name in codeData) {\n        key = key.replace(name, codeData[name]);\n    }\n    return key.replace(/\\s/g, \"\");\n}\n\n/**\n * @memberof KeyController\n */\nexport function getCombi(e: KeyboardEvent, key: string = getKey(e.keyCode)): string[] {\n    const keys = [e.shiftKey && \"shift\", e.ctrlKey && \"ctrl\", e.altKey && \"alt\", e.metaKey && \"meta\"];\n    keys.indexOf(key) === -1 && keys.push(key);\n\n    return keys.filter(Boolean);\n}\n\nfunction getArrangeCombi(keys: string[]) {\n    const arrangeKeys = keys.slice();\n    arrangeKeys.sort((prev, next) => {\n        const prevScore = keysSort[prev] || 5;\n        const nextScore = keysSort[next] || 5;\n\n        return prevScore - nextScore;\n    });\n\n    return arrangeKeys;\n}\n/**\n * @typedef\n * @memberof KeyController\n */\nexport interface KeyControllerEvent {\n    inputEvent: KeyboardEvent;\n    isToggle: boolean;\n    key: string;\n    keyCode: number;\n    ctrlKey: boolean;\n    altKey: boolean;\n    shiftKey: boolean;\n    metaKey: boolean;\n}\n/**\n */\nclass KeyController extends Component {\n    /**\n     */\n    public ctrlKey = false;\n    /**\n     */\n    public altKey = false;\n    /**\n     *\n     */\n    public shiftKey = false;\n    /**\n     *\n     */\n    public metaKey = false;\n    /**\n     *\n     */\n    constructor(container: Window | Document | HTMLElement = window) {\n        super();\n\n        addEvent(container, \"blur\", this.clear);\n        addEvent(container, \"keydown\", this.keydownEvent);\n        addEvent(container, \"keyup\", this.keyupEvent);\n    }\n    public clear = (): this => {\n        this.ctrlKey = false;\n        this.altKey = false;\n        this.shiftKey = false;\n        this.metaKey = false;\n        return this;\n    }\n    public keydown(comb: string | string[], callback: (e: KeyControllerEvent) => void): this;\n    public keydown(callback: (e: KeyControllerEvent) => void): this;\n    /**\n     *\n     */\n    public keydown(\n        comb: string | string[] | ((e: KeyControllerEvent) => void),\n        callback?: (e: KeyControllerEvent) => void,\n    ): this {\n        return this.addEvent(\"keydown\", comb, callback);\n    }\n    public keyup(comb: string | string[], callback: (e: KeyControllerEvent) => void): this;\n    public keyup(callback: (e: KeyControllerEvent) => void): this;\n    /**\n     *\n     */\n    public keyup(\n        comb: string | string[] | ((e: KeyControllerEvent) => void),\n        callback?: (e: KeyControllerEvent) => void,\n    ): this {\n        return this.addEvent(\"keyup\", comb, callback);\n    }\n    private addEvent(\n        type: \"keydown\" | \"keyup\",\n        comb: string | string[] | ((e: KeyControllerEvent) => void),\n        callback?: (e: KeyControllerEvent) => void,\n    ) {\n        if (isArray(comb)) {\n            this.on(`${type}.${getArrangeCombi(comb).join(\".\")}`, callback);\n        } else if (isString(comb)) {\n            this.on(`${type}.${comb}`, callback);\n        } else {\n            this.on(type, comb);\n        }\n        return this;\n    }\n    private triggerEvent(type: \"keydown\" | \"keyup\", e: KeyboardEvent) {\n        this.ctrlKey = e.ctrlKey;\n        this.shiftKey = e.shiftKey;\n        this.altKey = e.altKey;\n        this.metaKey = e.metaKey;\n\n        const key = getKey(e.keyCode);\n        const isToggle = key === \"ctrl\"\n            || key === \"shift\"\n            || key === \"meta\"\n            || key === \"alt\";\n        const param: KeyControllerEvent = {\n            key,\n            isToggle,\n            inputEvent: e,\n            keyCode: e.keyCode,\n            ctrlKey: e.ctrlKey,\n            altKey: e.altKey,\n            shiftKey: e.shiftKey,\n            metaKey: e.metaKey,\n        };\n        this.trigger(type, param);\n        this.trigger(`${type}.${key}`, param);\n\n        const combi = getCombi(e, key);\n\n        combi.length > 1 && this.trigger(`${type}.${combi.join(\".\")}`, param);\n    }\n    private keydownEvent = (e: KeyboardEvent) => {\n        this.triggerEvent(\"keydown\", e);\n    }\n    private keyupEvent = (e: KeyboardEvent) => {\n        this.triggerEvent(\"keyup\", e);\n    }\n}\n\nexport default KeyController;\n"],"names":["codeData","keysSort","shift","ctrl","alt","meta","getKey","keyCode","key","names","name","replace","getCombi","e","keys","shiftKey","ctrlKey","altKey","metaKey","indexOf","push","filter","Boolean","getArrangeCombi","arrangeKeys","slice","sort","prev","next","prevScore","nextScore","tslib_1","container","_super","_this","triggerEvent","addEvent","clear","keydownEvent","keyupEvent","comb","callback","type","isArray","on","join","isString","isToggle","param","inputEvent","trigger","combi","length","Component"],"mappings":"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"}